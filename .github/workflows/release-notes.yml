name: Generate Release Notes

on:
  release:
    types: [published] # Triggered when a new release is published

jobs:
  build:
    name: Generate and Update Release Notes
    runs-on: ubuntu-latest
    permissions:
      contents: write # Grant write permission for the GITHUB_TOKEN

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Required to fetch all history for release notes generation

      - name: Generate release notes
        id: release_notes
        uses: amannn/action-release-notes@v1.5.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          # This action automatically uses the release tag if fromTag and toTag are not specified.
          # It generates notes for the commits associated with the tag that triggered the release.
          # You can optionally provide a config file for more customization.
          # configFilePath: '.github/release-notes-config.json' # Example for custom config

      - name: Update GitHub Release
        uses: softprops/action-gh-release@v1
        if: steps.release_notes.outputs.release_notes != ''
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          tag_name: ${{ github.event.release.tag_name }}
          body: ${{ steps.release_notes.outputs.release_notes }}
          prerelease: ${{ github.event.release.prerelease }}
          draft: ${{ github.event.release.draft }}
          # If you want to append to existing notes, you can use append_body: true
          # append_body: true 
